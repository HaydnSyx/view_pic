# View Pic - 实现文档 v1.0

## 实现日期
2026-01-08

## 版本信息
- **版本号**: v1.0.0
- **状态**: 首次完整实现

---

## 已实现功能清单

### ✅ 1. 文件夹导航（左侧面板）
**实现内容**:
- ✅ 显示常用文件夹（桌面、文档、图片、下载）
- ✅ 文件夹点击跳转功能
- ✅ 文件夹悬停高亮效果
- ✅ 美观的图标设计

**技术实现**:
- 使用 `Path.home()` 获取用户主目录
- 使用 `ft.Column` 实现可滚动的文件夹列表
- 使用 `on_hover` 实现悬停效果

---

### ✅ 2. 图片展示区域（右侧面板）

#### 2.1 列表视图
**实现内容**:
- ✅ 显示图片图标、名称
- ✅ 显示图片文件大小（MB）
- ✅ 点击跳转到大图预览
- ✅ 悬停高亮效果

**技术实现**:
- 使用 `os.stat()` 获取文件大小
- 使用 `ft.Column` 垂直排列图片项

#### 2.2 缩略图视图
**实现内容**:
- ✅ 网格布局展示图片缩略图
- ✅ 显示图片名称（支持省略号）
- ✅ 缩略图尺寸 150x150px
- ✅ 点击跳转到大图预览

**技术实现**:
- 使用 `PIL.Image.thumbnail()` 生成缩略图
- 使用 `base64` 编码传递图片数据
- 使用 `ft.Row(wrap=True)` 实现流式布局

---

### ✅ 3. 缩略图自适应布局
**实现内容**:
- ✅ 监听窗口 `resize` 事件
- ✅ 根据窗口宽度动态计算每行显示的图片数量
- ✅ 最小 2 列，最大根据窗口宽度自动调整

**技术实现**:
```python
container_width = self.page.window_width - 280 - 60
thumbnail_size = 150
cols = max(2, int(container_width // (thumbnail_size + 20)))
```

---

### ✅ 4. 移动设备识别
**实现内容**:
- ✅ 实时监听 `/Volumes` 目录
- ✅ 每 3 秒自动刷新设备列表
- ✅ 支持点击访问移动设备中的图片
- ✅ 显示 USB 图标

**技术实现**:
- 使用独立线程 `threading.Thread` 后台监听
- 使用 `daemon=True` 确保程序退出时线程自动结束
- 使用 `time.sleep(3)` 控制检测频率

---

### ✅ 5. 大图预览
**实现内容**:
- ✅ 点击图片弹出全屏遮罩预览
- ✅ 左右箭头按钮切换上/下一张
- ✅ 关闭按钮
- ✅ 图片自适应容器大小（1000x700px）

**技术实现**:
- 使用 `ft.AlertDialog` 实现模态对话框
- 使用 `ft.Stack` 叠加图片和控制按钮
- 使用 `ft.ImageFit.CONTAIN` 保持图片比例

---

### ✅ 6. 支持的图片格式
**本期实现**:
- ✅ JPG
- ✅ JPEG
- ✅ PNG
- ✅ GIF

**后续版本计划**:
- ⏳ BMP
- ⏳ WEBP
- ⏳ HEIC
- ⏳ TIFF

---

### ✅ 7. 性能优化
**虚拟滚动实现**:
- ✅ 首次加载只显示前 100 张图片
- ✅ 避免一次性加载大量图片导致卡顿
- ✅ 缩略图使用 `PIL.Image.thumbnail()` 压缩

**缓存机制**:
- ⏳ 后续版本将实现缩略图本地缓存

---

### ✅ 8. 界面设计

#### 8.1 色彩方案
- **主色**: `#1976D2` (深蓝色) - 用于强调元素
- **辅助色**: `#E3F2FD` (浅蓝色) - 用于标题栏和悬停效果
- **背景色**: `#FFFFFF` (白色) - 主内容区
- **边框色**: `#E0E0E0` (浅灰色) - 分隔线
- **文字色**: `#333333` (深灰色)

#### 8.2 设计特点
- ✅ 圆角设计（border_radius=8）
- ✅ 悬停效果（hover state）
- ✅ 图标清晰明了
- ✅ 留白适当，视觉舒适

---

## 技术栈

### 核心依赖
- **Python**: 3.12
- **Flet**: >=0.24.0 (跨平台 GUI 框架)
- **Pillow**: >=10.0.0 (图像处理库)

### 关键技术
- **多线程**: 使用 `threading` 实现设备监听
- **图像处理**: 使用 `PIL` 生成缩略图
- **Base64 编码**: 传递图片数据到前端
- **响应式布局**: 监听窗口变化动态调整

---

## 文件结构

```
view_pic/
├── main.py                    # 主程序（467 行）
├── pyproject.toml             # 项目配置
├── doc/
│   ├── requirements.md        # 需求文档
│   └── implementation_v1.0.md # 本实现文档
└── README.md
```

---

## 核心代码说明

### 主类: `ImageViewerApp`

#### 关键属性
```python
self.current_folder = None          # 当前选中的文件夹
self.images = []                    # 当前文件夹的图片列表
self.view_mode = "grid"             # 视图模式: "grid" | "list"
self.current_image_index = 0        # 当前预览的图片索引
self.supported_formats = (...)      # 支持的图片格式
```

#### 核心方法
1. **`main(page)`**: 应用入口，初始化页面
2. **`create_ui()`**: 创建整体 UI 布局
3. **`build_folder_tree()`**: 构建左侧文件夹树
4. **`load_folder(path)`**: 加载文件夹中的图片
5. **`display_images()`**: 根据视图模式显示图片
6. **`display_grid_view()`**: 网格视图
7. **`display_list_view()`**: 列表视图
8. **`create_thumbnail(path, size)`**: 生成缩略图
9. **`preview_image_at_index(index)`**: 预览指定图片
10. **`show_preview()`**: 显示大图预览对话框
11. **`update_device_list()`**: 更新移动设备列表
12. **`start_device_monitoring()`**: 启动设备监听线程

---

## 运行方式

### 开发模式
```bash
cd /Users/syx/Documents/WorkSpace/project/view_pic
uv run python main.py
```

### 打包发布（后续）
```bash
# 使用 PyInstaller 打包成 macOS 应用
pyinstaller --name="View Pic" --windowed main.py
```

---

## 已知限制

### 1. 虚拟滚动限制
- 当前只加载前 100 张图片
- 如需查看更多，需要后续实现真正的虚拟滚动

### 2. 缩略图生成速度
- 首次加载大量图片时可能有短暂延迟
- 建议后续版本增加缓存机制

### 3. 设备监听
- 使用轮询方式（每 3 秒检查一次）
- 可能有 3 秒延迟，未来可考虑使用文件系统监听 API

### 4. 大图预览
- 预览窗口固定大小（1000x700px）
- 未来可考虑全屏模式

---

## 后续优化计划

### v1.1 版本计划
- [ ] 支持更多图片格式（BMP, WEBP, HEIC）
- [ ] 实现真正的虚拟滚动（无限加载）
- [ ] 缩略图本地缓存
- [ ] 文件夹树展开/折叠功能
- [ ] 图片搜索功能

### v1.2 版本计划
- [ ] 全屏大图预览模式
- [ ] 键盘快捷键支持（方向键切换图片）
- [ ] 图片信息面板（EXIF 信息）
- [ ] 图片排序功能（按名称、大小、日期）

### v1.3 版本计划
- [ ] 图片简单编辑功能（旋转、裁剪）
- [ ] 幻灯片播放
- [ ] 支持拖拽操作
- [ ] 多语言支持

---

## 测试建议

### 功能测试
1. ✅ 点击不同文件夹，验证图片加载
2. ✅ 切换列表/网格视图
3. ✅ 调整窗口大小，验证自适应布局
4. ✅ 插拔 U 盘，验证设备识别
5. ✅ 点击图片预览，左右切换

### 性能测试
1. ⏳ 测试包含 1000+ 图片的文件夹
2. ⏳ 测试大尺寸图片（10MB+）的加载速度
3. ⏳ 测试快速切换文件夹的响应速度

### 兼容性测试
1. ⏳ 在不同 macOS 版本上测试
2. ⏳ 测试不同分辨率的显示器
3. ⏳ 测试 Retina 高分屏显示效果

---

## 问题反馈

如有任何问题或建议，请联系开发者或提交 Issue。

---

**文档更新时间**: 2026-01-08  
**作者**: AI Assistant  
**状态**: ✅ v1.0 开发完成

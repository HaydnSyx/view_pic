# View Pic - 图片查看器需求文档 v2.0

## 版本信息

**版本**: v2.0.0  
**创建日期**: 2026-01-10  
**迭代主题**: 图片预览交互优化  
**基于版本**: v1.0.0

---

## 项目概述

本次迭代（v2.0）主要聚焦于优化图片预览功能的用户交互体验，提升操作便捷性和流畅度。在 v1.0 基础上，增强键盘快捷键支持、优化预览界面布局、实现循环浏览等功能。

---

## 二期核心需求

### 1. 键盘快捷键支持

#### 1.1 左右方向键切换图片
- **需求描述**: 在图片预览模式下，用户可通过键盘左右方向键快速切换图片
- **功能点**:
  - 按下 **左方向键 (←)**: 显示上一张图片
  - 按下 **右方向键 (→)**: 显示下一张图片
  - 支持连续按键快速浏览
  - 与界面上的左右箭头按钮功能一致
- **用户价值**: 提升浏览效率，无需鼠标即可快速切换图片

#### 1.2 ESC键关闭预览
- **需求描述**: 用户可通过ESC键快速关闭图片预览
- **功能点**:
  - 按下 **ESC键**: 关闭当前预览对话框，返回主界面
  - 与界面上的关闭按钮功能一致
- **用户价值**: 提供快捷的退出方式，符合用户操作习惯

---

### 2. 预览界面优化

#### 2.1 关闭按钮位置调整
- **需求描述**: 将关闭按钮从右下角移至右上角
- **功能点**:
  - 关闭按钮位置: **右上角**
  - 图标样式: 使用 **× (叉号)** 图标
  - 按钮样式: 半透明背景，白色图标
  - 悬停效果: 高亮显示
- **设计理由**: 
  - 符合现代应用的设计规范
  - 右上角关闭符合用户操作习惯
  - 避免与底部控制栏冲突

#### 2.2 图片位置指示器
- **需求描述**: 在预览图片下方显示当前图片位置信息
- **功能点**:
  - 显示格式: **"当前位置 / 总数量"**（例如: "3 / 25"）
  - 显示位置: 图片下方居中
  - 样式设计:
    - 半透明深色背景
    - 白色文字
    - 圆角设计
    - 适当的内边距
- **用户价值**: 
  - 让用户明确知道当前浏览进度
  - 了解图片集合的总数量
  - 提升方向感和控制感

---

### 3. 循环浏览功能

#### 3.1 首尾循环切换
- **需求描述**: 实现图片列表的循环浏览，首尾互通
- **功能点**:
  - **浏览到最后一张时**:
    - 点击"下一张"按钮 → 跳转到第一张
    - 按下右方向键 (→) → 跳转到第一张
  - **浏览到第一张时**:
    - 点击"上一张"按钮 → 跳转到最后一张
    - 按下左方向键 (←) → 跳转到最后一张
  - 切换过程流畅，无卡顿
- **用户价值**: 
  - 无需手动返回起点或终点
  - 提升连续浏览体验
  - 适合需要循环对比图片的场景

---

## 技术实现方案

### 1. 键盘事件监听

#### 实现方式
- 使用 Flet 的 `page.on_keyboard_event` 监听键盘事件
- 在预览对话框打开时激活键盘监听
- 在预览对话框关闭时取消监听

#### 关键代码逻辑
```python
def on_keyboard_event(self, e):
    """处理键盘事件"""
    if self.preview_dialog.open:
        if e.key == "Arrow Left":
            self.show_previous_image(None)
        elif e.key == "Arrow Right":
            self.show_next_image(None)
        elif e.key == "Escape":
            self.close_preview(None)
```

---

### 2. 循环浏览逻辑

#### 实现方式
- 修改 `show_previous_image()` 方法
- 修改 `show_next_image()` 方法
- 使用取模运算实现循环

#### 关键代码逻辑
```python
def show_previous_image(self, e):
    """显示上一张图片（支持循环）"""
    if len(self.images) > 0:
        self.current_image_index = (self.current_image_index - 1) % len(self.images)
        self.show_preview()

def show_next_image(self, e):
    """显示下一张图片（支持循环）"""
    if len(self.images) > 0:
        self.current_image_index = (self.current_image_index + 1) % len(self.images)
        self.show_preview()
```

---

### 3. UI 布局调整

#### 预览对话框结构
```
┌─────────────────────────────────────────┐
│                    [×]  ← 关闭按钮      │
│                                         │
│   [<]     [预览图片]        [>]        │
│                                         │
│              [3 / 25]  ← 位置指示器    │
└─────────────────────────────────────────┘
```

#### 实现要点
- 使用 `ft.Stack` 叠加层级
- 关闭按钮使用 `alignment=ft.Alignment(1, -1)` 定位到右上角
- 位置指示器使用 `alignment=ft.Alignment(0, 1)` 定位到底部居中

---

## 界面设计规范

### 色彩方案（继承 v1.0）
- 主色: `#1976D2` (深蓝色)
- 辅助色: `#E3F2FD` (浅蓝色)
- 背景色: `#FFFFFF` (白色)
- 半透明背景: `#00000080` (黑色 50% 透明度)
- 文字色: `#FFFFFF` (预览模式下使用白色)

### 新增组件样式

#### 关闭按钮
- 图标: `ft.icons.CLOSE` (×)
- 背景色: `#00000080` (半透明黑色)
- 图标颜色: `white`
- 尺寸: `40x40` px
- 圆角: `20px` (圆形)
- 悬停效果: 背景色加深至 `#000000B0`

#### 位置指示器
- 背景色: `#00000080` (半透明黑色)
- 文字颜色: `white`
- 文字大小: `16px`
- 内边距: `10px 20px`
- 圆角: `20px`
- 字体: 等宽字体（保持数字对齐）

---

## 用户体验优化

### 1. 操作流畅性
- 键盘响应延迟 < 100ms
- 图片切换过渡时间 < 300ms
- 支持连续快速按键

### 2. 视觉反馈
- 悬停时按钮高亮
- 键盘操作时提供视觉响应
- 循环切换时无明显跳跃感

### 3. 用户引导
- 首次使用时可考虑显示快捷键提示（可选）
- 位置指示器清晰可见
- 关闭按钮位置符合直觉

---

## 测试计划

### 功能测试
1. ✅ 测试左右方向键切换图片
2. ✅ 测试ESC键关闭预览
3. ✅ 测试循环浏览（首→尾，尾→首）
4. ✅ 测试位置指示器显示正确
5. ✅ 测试关闭按钮位置和功能

### 边界测试
1. ✅ 只有1张图片时的循环行为
2. ✅ 空文件夹时的行为
3. ✅ 快速连续按键的响应

### 兼容性测试
1. ✅ 验证在不同窗口尺寸下的显示
2. ✅ 验证键盘事件在 macOS 上的兼容性

---

## 实现优先级

### P0 (必须实现)
1. 键盘左右方向键切换图片
2. ESC键关闭预览
3. 循环浏览功能
4. 位置指示器显示

### P1 (高优先级)
1. 关闭按钮移至右上角
2. 关闭按钮改为×图标

### P2 (可选优化)
1. 键盘快捷键提示
2. 切换动画效果
3. 预加载下一张图片

---

## 风险与限制

### 潜在风险
1. **键盘事件冲突**: 可能与系统快捷键冲突
   - **解决方案**: 仅在预览对话框打开时监听键盘事件
2. **大图片加载延迟**: 循环切换时可能出现加载延迟
   - **解决方案**: 预加载相邻图片（v2.1 优化）

### 已知限制
1. 当前版本仅支持方向键和ESC键
2. 暂不支持其他快捷键（如空格键播放幻灯片）

---

## 后续版本规划

### v2.1 版本计划
- [ ] 预加载相邻图片，提升切换速度
- [ ] 支持空格键暂停/播放自动播放
- [ ] 支持Home/End键跳转到首/尾
- [ ] 添加缩放功能（滚轮放大缩小）

### v2.2 版本计划
- [ ] 全屏预览模式
- [ ] 幻灯片自动播放
- [ ] 键盘快捷键帮助面板
- [ ] 图片对比模式（并排显示两张图片）

---

## 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v2.0.0 | 2026-01-10 | 二期需求：图片预览交互优化 | AI Assistant |

---

**备注**: 
- 本文档基于 v1.0 需求文档编写
- 所有功能均为增量更新，不影响 v1.0 已有功能
- 实现过程中如有调整，将及时更新本文档
